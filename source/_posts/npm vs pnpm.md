---
title: npm vs pnpm
date: 2025-09-01 10:00:00
updated: 2025-09-02 11:00:00
---
> [软链接硬链接]()
`pnpm` 和 `npm` 都是 Node.js 生态系统中的包管理器，用于安装、更新、卸载和管理项目依赖。它们的主要区别体现在性能、磁盘空间使用、依赖结构和安装方式上。

以下是 `pnpm` 和 `npm` 的主要区别：

### 1. 依赖存储方式（核心区别）

*   **npm**:
    *   从 npm 3.x 开始，npm 采用扁平化依赖结构（flat dependency tree）。
    *   它会将所有依赖尽可能地提升到 `node_modules` 的根目录，以减少嵌套层级。
    *   但是，当存在版本冲突时，它仍然会在子目录中安装不同版本的包。
    *   每个项目都会独立下载和存储其依赖，即使多个项目使用相同的包版本，也会在各自的 `node_modules` 中重复存储，占用更多磁盘空间。

*   **pnpm**:
    *   采用**内容可寻址存储**（Content-Addressable Store）和**硬链接**（Hard Links）机制。
    *   所有下载的包都存储在一个全局的、单一的内容可寻址存储中（通常位于用户主目录下，如 `~/.pnpm-store`）。
    *   当一个项目需要某个包时，`pnpm` 会从全局存储中创建指向该包的**硬链接**到项目的 `node_modules` 中。
    *   这意味着**相同的包版本在磁盘上只存储一份**，无论被多少个项目使用，极大地节省了磁盘空间。
    *   项目中的 `node_modules` 结构是“符号链接 + 硬链接”的混合体，结构更严格，更接近 `node_modules` 的原始嵌套结构（类似 npm 2.x），但通过链接避免了重复。

### 2. 安装速度

*   **首次安装**：对于一个新项目，如果全局存储中没有所需包，`pnpm` 需要先下载并存入全局存储，然后创建链接，速度可能与 `npm` 相近或稍慢。
*   **后续安装/重复安装**：如果所需包已在全局存储中，`pnpm` 只需创建硬链接，速度**极快**，远超 `npm` 的重复下载和解压。
*   **总体速度**：由于避免了重复下载和解压，`pnpm` 在大多数情况下的安装速度（尤其是 CI/CD 环境或频繁创建项目时）**显著快于 `npm`**。

### 3. 磁盘空间占用

*   **npm**：每个项目的 `node_modules` 都包含完整的依赖副本，占用大量磁盘空间，尤其是在有多个项目时。
*   **pnpm**：利用全局存储和硬链接，**磁盘空间占用远小于 `npm`**。相同包版本只存储一份。

### 4. 依赖隔离与“幻影依赖”（Phantom Dependencies）

*   **npm**：扁平化结构可能导致“幻影依赖”问题。即项目代码中 `import` 了一个并未在 `package.json` 中声明的包，但由于该包是其他依赖的子依赖并被提升到了根目录，代码也能运行。这会带来依赖关系不明确、潜在的版本冲突和构建失败风险。
*   **pnpm**：其严格的 `node_modules` 结构（更接近嵌套）**有效防止了“幻影依赖”**。只有在 `package.json` 中明确声明的依赖，其直接子依赖才能被访问。这强制开发者显式声明所有依赖，提高了项目的可维护性和可靠性。

### 5. 兼容性

*   **pnpm**：高度兼容 `npm`。`pnpm` 使用相同的 `package.json` 格式和 `npm` registry。大多数为 `npm` 设计的包也能在 `pnpm` 下正常工作。`pnpm` 也提供了 `pnpmfile.js` 用于处理极少数不兼容的情况。

### 6. 命令行语法

*   `pnpm` 的命令行语法与 `npm` **几乎完全相同**。例如：
    *   `npm install` -> `pnpm install` (或 `pnpm i`)
    *   `npm install package-name` -> `pnpm add package-name`
    *   `npm run script-name` -> `pnpm run script-name`
    *   这使得从 `npm` 迁移到 `pnpm` 非常容易。

### 总结

| 特性         | npm                            | pnpm                                      |
| :----------- | :----------------------------- | :---------------------------------------- |
| **存储方式**   | 每个项目独立存储，可能重复       | 全局内容可寻址存储 + 硬链接，避免重复       |
| **磁盘占用**   | 较高                           | **极低** (相同版本只存一份)                 |
| **安装速度**   | 一般                           | **更快** (尤其在有缓存时)                   |
| **依赖结构**   | 扁平化 (可能产生幻影依赖)       | 更严格嵌套 (**防止幻影依赖**)               |
| **兼容性**    | 原生                           | 高度兼容 `npm`                             |
| **命令语法**   | `npm xxx`                     | `pnpm xxx` (几乎相同)                     |

**简单来说**：`pnpm` 在保持与 `npm` 高度兼容的同时，通过创新的存储机制，**显著提升了安装速度，大幅节省了磁盘空间，并增强了依赖管理的严格性**。如果你追求效率和更好的依赖管理实践，`pnpm` 是一个非常值得考虑的优秀替代品。